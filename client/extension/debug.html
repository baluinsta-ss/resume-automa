<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>ResumeMatch Pro - Debug</title>
    <style>
      body {
        font-family: monospace;
        padding: 20px;
        background: #1e1e1e;
        color: #d4d4d4;
        max-width: 1000px;
        margin: 0 auto;
      }
      h1 {
        color: #4ec9b0;
      }
      .section {
        margin: 20px 0;
        padding: 15px;
        background: #252526;
        border-left: 3px solid #007acc;
        border-radius: 4px;
      }
      .status {
        padding: 10px;
        margin: 5px 0;
        border-radius: 4px;
        font-size: 13px;
      }
      .success {
        background: #1e541e;
        color: #4ec9b0;
      }
      .error {
        background: #5a1d1d;
        color: #f48771;
      }
      .info {
        background: #1e3a5f;
        color: #9cdcfe;
      }
      button {
        background: #007acc;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px 5px 5px 0;
        font-size: 13px;
      }
      button:hover {
        background: #005a9e;
      }
      pre {
        background: #1e1e1e;
        padding: 10px;
        border-radius: 4px;
        overflow-x: auto;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <h1>üîç ResumeMatch Pro - Debug Console</h1>

    <div class="section">
      <h2>üìã localStorage Check</h2>
      <button onclick="checkLocalStorage()">Check localStorage</button>
      <div id="localStorage-result"></div>
    </div>

    <div class="section">
      <h2>üíæ chrome.storage.sync Check</h2>
      <button onclick="checkChromeStorage()">Check chrome.storage.sync</button>
      <div id="chrome-storage-result"></div>
    </div>

    <div class="section">
      <h2>üîÑ Sync Resume Now</h2>
      <button onclick="syncResumeNow()">Force Sync Resume to Extension</button>
      <div id="sync-result"></div>
    </div>

    <div class="section">
      <h2>üì° Content Script Check</h2>
      <div id="content-script-result"></div>
    </div>

    <script>
      function log(elementId, type, message) {
        const el = document.getElementById(elementId);
        const statusEl = document.createElement("div");
        statusEl.className = `status ${type}`;
        statusEl.textContent = message;
        el.appendChild(statusEl);
      }

      function checkLocalStorage() {
        const result = document.getElementById("localStorage-result");
        result.innerHTML = "";

        try {
          const resumeKey = "resumematch_master_resume";
          const resumeData = localStorage.getItem(resumeKey);

          if (resumeData) {
            try {
              const parsed = JSON.parse(resumeData);
              log(
                "localStorage-result",
                "success",
                "‚úì Resume found in localStorage",
              );
              log(
                "localStorage-result",
                "info",
                `Name: ${parsed.contact?.name || "Unknown"}`,
              );
              log(
                "localStorage-result",
                "info",
                `Size: ${resumeData.length} bytes`,
              );
            } catch (e) {
              log(
                "localStorage-result",
                "error",
                `‚úó Resume exists but is not valid JSON: ${e.message}`,
              );
            }
          } else {
            log(
              "localStorage-result",
              "error",
              "‚úó No resume found in localStorage",
            );
          }
        } catch (e) {
          log(
            "localStorage-result",
            "error",
            `‚úó Error reading localStorage: ${e.message}`,
          );
        }
      }

      function checkChromeStorage() {
        const result = document.getElementById("chrome-storage-result");
        result.innerHTML = "";

        if (!chrome || !chrome.storage || !chrome.storage.sync) {
          log(
            "chrome-storage-result",
            "error",
            "‚úó chrome.storage.sync not available",
          );
          return;
        }

        chrome.storage.sync.get(null, (items) => {
          if (chrome.runtime.lastError) {
            log(
              "chrome-storage-result",
              "error",
              `‚úó Error: ${chrome.runtime.lastError.message}`,
            );
            return;
          }

          const resumeKey = "resumematch_master_resume";
          const resumeData = items[resumeKey];

          if (resumeData) {
            try {
              const parsed =
                typeof resumeData === "string"
                  ? JSON.parse(resumeData)
                  : resumeData;
              log(
                "chrome-storage-result",
                "success",
                "‚úì Resume found in chrome.storage.sync",
              );
              log(
                "chrome-storage-result",
                "info",
                `Name: ${parsed.contact?.name || "Unknown"}`,
              );
            } catch (e) {
              log(
                "chrome-storage-result",
                "error",
                `‚úó Resume exists but invalid: ${e.message}`,
              );
            }
          } else {
            log(
              "chrome-storage-result",
              "error",
              "‚úó No resume found in chrome.storage.sync",
            );
          }

          log(
            "chrome-storage-result",
            "info",
            `Total items in storage: ${Object.keys(items).length}`,
          );
        });
      }

      function syncResumeNow() {
        const result = document.getElementById("sync-result");
        result.innerHTML = "";

        try {
          const resumeKey = "resumematch_master_resume";
          const resumeData = localStorage.getItem(resumeKey);

          if (!resumeData) {
            log("sync-result", "error", "‚úó No resume in localStorage to sync");
            return;
          }

          if (!chrome.storage.sync) {
            log("sync-result", "error", "‚úó chrome.storage.sync not available");
            return;
          }

          chrome.storage.sync.set({ [resumeKey]: resumeData }, () => {
            if (chrome.runtime.lastError) {
              log(
                "sync-result",
                "error",
                `‚úó Sync failed: ${chrome.runtime.lastError.message}`,
              );
            } else {
              log(
                "sync-result",
                "success",
                "‚úì Resume synced to chrome.storage.sync!",
              );
              log(
                "sync-result",
                "info",
                "The popup should now show the resume.",
              );
            }
          });
        } catch (e) {
          log("sync-result", "error", `‚úó Error: ${e.message}`);
        }
      }

      function checkContentScript() {
        const result = document.getElementById("content-script-result");
        result.innerHTML = "";

        chrome.tabs.query({ url: "http://localhost:*/*" }, (tabs) => {
          if (tabs.length === 0) {
            log(
              "content-script-result",
              "info",
              "‚ÑπÔ∏è No localhost tabs found. Open http://localhost:8080 in a tab.",
            );
            return;
          }

          tabs.forEach((tab) => {
            chrome.tabs.sendMessage(tab.id, { action: "checkSync" }, () => {
              if (chrome.runtime.lastError) {
                log(
                  "content-script-result",
                  "error",
                  `‚úó Content script not responding on ${tab.url}`,
                );
              } else {
                log(
                  "content-script-result",
                  "success",
                  `‚úì Content script active on ${tab.url}`,
                );
              }
            });
          });
        });
      }

      // Auto-check on load
      window.addEventListener("load", () => {
        checkLocalStorage();
        checkChromeStorage();
        checkContentScript();
      });
    </script>
  </body>
</html>
